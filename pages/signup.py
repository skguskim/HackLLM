# pages/signup.py
import streamlit as st
from utils.auth import get_client, current_user
from utils.ui import render_sidebar_menu

user = current_user()

render_sidebar_menu()

st.header("ğŸ“ íšŒì›ê°€ì…")

supabase = get_client()

email = st.text_input("Email")
pwd   = st.text_input("Password", type="password")

# ì„œë¹„ìŠ¤ ì•½ê´€ ì„¹ì…˜
st.markdown("---")
st.markdown("### ğŸ“‹ ì„œë¹„ìŠ¤ ì´ìš©ì•½ê´€")

with st.expander("ğŸ“„ ê°œì¸ì •ë³´ì²˜ë¦¬ë°©ì¹¨ (í•„ìˆ˜)", expanded=False):
    st.markdown("""
    #### LLL Corporation CTF í”Œë«í¼ ì´ìš©ì•½ê´€
    
    1. **ìˆ˜ì§‘ í•­ëª©** â€• ì´ë©”ì¼ ì£¼ì†Œ(í•„ìˆ˜).

    2. **ìˆ˜ì§‘Â·ì´ìš© ëª©ì ** â€• â‘  íšŒì›ê°€ì…Â·ê³„ì • ì‹ë³„Â·ë³¸ì¸í™•ì¸, â‘¡ CTF ë¬¸ì œ í’€ì´ ê²°ê³¼Â·ë³´ì•ˆ ì•Œë¦¼ ë“± í•„ìˆ˜ ìš´ì˜ ë©”ì¼ ë°œì†¡.

    3. **ë²•ì  ê·¼ê±°** â€• ê°œì¸ì •ë³´ ë³´í˜¸ë²• ì œ30ì¡°(ì²˜ë¦¬ë°©ì¹¨ ê³µê°œ) ë° ìµœì†Œ ìˆ˜ì§‘ ì›ì¹™. (êµ­ê°€ë²•ë ¹ì •ë³´ì„¼í„°, êµ­ê°€ë²•ë ¹ì •ë³´ì„¼í„°)

    4. **ë³´ìœ Â·íŒŒê¸°** â€• 2025-08-02 23:59(KST)ê¹Œì§€ ë³´ê´€ í›„ ì¦‰ì‹œ ì™„ì „ ì‚­ì œ

    5. **ìˆ˜ì‹  ê±°ë¶€** â€• ìš´ì˜ ë©”ì¼ì€ ì„œë¹„ìŠ¤ í•„ìˆ˜ì´ë¯€ë¡œ ì² íšŒ ë¶ˆê°€

    6. **ì •ë³´ì£¼ì²´ ê¶Œë¦¬** â€• ì´ë©”ì¼ ë³€ê²½Â·ì‚­ì œÂ·ì—´ëŒ ìš”êµ¬ ê°€ëŠ¥

    7. **ì œ3ì ì œê³µ** â€• ì—†ìŒ.
                
    8. **ë™ì˜ ê±°ë¶€ ê¶Œë¦¬ ë° ë¶ˆì´ìµ** - ê°œì¸ì •ë³´ ìˆ˜ì§‘ ë° ì´ìš©ì— ë™ì˜í•˜ì§€ ì•Šì„ ê¶Œë¦¬ê°€ ìˆìŒ. ë‹¨, ë™ì˜í•˜ì§€ ì•Šì„ ê²½ìš° íšŒì›ê°€ì… ë° ì„œë¹„ìŠ¤ ì´ìš©ì´ ì œí•œ
                
    ---
    ìµœì¢… ìˆ˜ì •ì¼: 2025ë…„ 7ì›” 20ì¼
    """)

# ì•½ê´€ ë™ì˜ ì²´í¬ë°•ìŠ¤
st.markdown("---")
terms_agreed = st.checkbox("ğŸ“‹ **ì´ìš©ì•½ê´€ì— ë™ì˜í•©ë‹ˆë‹¤** (í•„ìˆ˜)", key="terms_agreement")

if not terms_agreed:
    st.warning("âš ï¸ í•„ìˆ˜ ì•½ê´€ì— ëª¨ë‘ ë™ì˜í•´ì•¼ íšŒì›ê°€ì…ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.")

if st.button("íšŒì›ê°€ì…", use_container_width=True, disabled=not terms_agreed):
    if not email or not pwd:
        st.error("ì´ë©”ì¼ê³¼ ë¹„ë°€ë²ˆí˜¸ë¥¼ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.")
    elif not terms_agreed:
        st.error("í•„ìˆ˜ ì•½ê´€ì— ëª¨ë‘ ë™ì˜í•´ì£¼ì„¸ìš”.")
    else:
        try:
            response = supabase.auth.sign_up({
                "email": email, 
                "password": pwd,
            })
            st.info("ğŸ“§ ì´ë©”ì¼ë¡œ ë°œì†¡ëœ ì¸ì¦ ë§í¬ë¥¼ í´ë¦­í•œ í›„ ë¡œê·¸ì¸í•´ ì£¼ì„¸ìš”.")
            
            # ì„±ê³µ ì‹œ ì•½ê´€ ë™ì˜ ìƒíƒœ í‘œì‹œ
            with st.expander("âœ… ë™ì˜ ì™„ë£Œ ë‚´ì—­"):
                st.write("- âœ… ê°œì¸ì •ë³´ì²˜ë¦¬ë°©ì¹¨ ë™ì˜")
                    
        except Exception as e:
            st.error(f"âŒ íšŒì›ê°€ì… ì‹¤íŒ¨: {e}")
            st.info("ğŸ’¡ ì´ë¯¸ ê°€ì…ëœ ì´ë©”ì¼ì´ê±°ë‚˜ ë¹„ë°€ë²ˆí˜¸ê°€ ë„ˆë¬´ ê°„ë‹¨í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.")